{% extends 'base.html' %}

{% block main %}

<div class="row">
  <div class="large-6 columns">
    <h5>Last emissions reported</h5>
    <table>
      <thead>
        <tr>
          <th>Tracking number</th>
          <th>County</th>
          <th>When</th>
          <th>Regulated Entity</th>
          <th>Duration</th>
        </tr>
      </thead>
      <tbody>
      {% for emission_event in emission_events %}
        <tr>
          <td>
            <a href="http://www11.tceq.texas.gov/oce/eer/index.cfm?fuseaction=main.getDetails&target={{emission_event.tracking_number}}" target="_blank">{{emission_event.tracking_number}}</a>
          </td>
          <td>{{emission_event.type_of_air_emissions_event|title}}</td>
          <td>{{ emission_event.began_date|date:"SHORT_DATE_FORMAT" }}</td>
          <td>{{emission_event.regulated_entity_name}}</td>
          <td>{{ emission_event.duration|floatformat}}hs.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="large-6 columns">
    <h5>Contaminants released in 2015</h5>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Tracking number</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
      {% for contaminant in contaminants %}
        <tr>
          <td>{{ contaminant.contaminant }}</td>
          <td>
            <a href="http://www11.tceq.texas.gov/oce/eer/index.cfm?fuseaction=main.getDetails&target={{contaminant.tracking_number}}" target="_blank">{{contaminant.tracking_number}}</a>
          </td>
          <td>{{ contaminant.amount_released }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="large-6 columns">
    <h5>Last orders issued</h5>
    <table>
      <thead>
        <tr>
          <th>Regulated Entity</th>
          <th>Docket number</th>
          <th>When</th>
          <th>Penalty</th>
        </tr>
      </thead>
      <tbody>
      {% for issued_order in issued_orders %}
        <tr>
          <td>{{ issued_order.regulated_entity_rn_number }}</td>
          <td>
            <a href="http://www14.tceq.texas.gov/epic/CIO/{{issued_order.docket_link}}">{{ issued_order.docket_number }}</a>
          </td>
          <td>{{ issued_order.agenda_date }}</td>
          <td>{{ issued_order.penalty_value }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="large-6 columns">
    <h5>Plants with more emission events registered in 2015</h5>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Zipcode</th>
          <th>County</th>
          <th>Number of emissions</th>
        </tr>
      </thead>
      <tbody>
      {% for regulated_entity in regulated_entities %}
        <tr>
          <td>{{ regulated_entity.name|title }}</td>
          <td>{{ regulated_entity.nearest_zipcode }}</td>
          <td>{{ regulated_entity.county|title }}</td>
          <td>{{ regulated_entity.num_events }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="large-8 columns">
    <canvas id="emissionsPerMonth" height="400" width="500px"></canvas>
  </div>
  <div class="large-4 columns">
    <canvas id="emissionsPerYear" height="400" width="500px"></canvas>
  </div>
</div>

{% endblock %}

{% block js %}
<script type="text/javascript">

  var emissionsPerMonth = {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
               "Jul", "Aug", "Set", "Oct", "Nov", "Dec"],
      datasets: [
          {
              label: "2014",
              fillColor: "",
              strokeColor: "",
              pointColor: "rgba(220,220,220,1)",
              pointStrokeColor: "#fff",
              pointHighlightFill: "#fff",
              pointHighlightStroke: "rgba(220,220,220,1)",
              data: [
                {{emissions_count.2014.1}},
                {{emissions_count.2014.2}},
                {{emissions_count.2014.3}},
                {{emissions_count.2014.4}},
                {{emissions_count.2014.5}},
                {{emissions_count.2014.6}},
                {{emissions_count.2014.7}},
                {{emissions_count.2014.8}},
                {{emissions_count.2014.9}},
                {{emissions_count.2014.10}},
                {{emissions_count.2014.11}},
                {{emissions_count.2014.12}}
              ]
          },
          {
              label: "2013",
              fillColor: "",
              strokeColor: "",
              pointColor: "rgba(151,187,205,1)",
              pointStrokeColor: "#fff",
              pointHighlightFill: "#fff",
              pointHighlightStroke: "rgba(151,187,205,1)",
              data: [
                {{emissions_count.2013.1}},
                {{emissions_count.2013.2}},
                {{emissions_count.2013.3}},
                {{emissions_count.2013.4}},
                {{emissions_count.2013.5}},
                {{emissions_count.2013.6}},
                {{emissions_count.2013.7}},
                {{emissions_count.2013.8}},
                {{emissions_count.2013.9}},
                {{emissions_count.2013.10}},
                {{emissions_count.2013.11}},
                {{emissions_count.2013.12}}
              ]
          },
          {
              label: "2012",
              fillColor: "",
              strokeColor: "#FF5A5E",
              pointColor: "#Fe5450",
              pointStrokeColor: "#fff",
              pointHighlightFill: "#fff",
              pointHighlightStroke: "#Fe5450",
              data: [
                {{emissions_count.2012.1}},
                {{emissions_count.2012.2}},
                {{emissions_count.2012.3}},
                {{emissions_count.2012.4}},
                {{emissions_count.2012.5}},
                {{emissions_count.2012.6}},
                {{emissions_count.2012.7}},
                {{emissions_count.2012.8}},
                {{emissions_count.2012.9}},
                {{emissions_count.2012.10}},
                {{emissions_count.2012.11}},
                {{emissions_count.2012.12}}
              ]
          }
      ]
  };

  var ctxMonth = document.getElementById("emissionsPerMonth").getContext("2d");
  var myLineChart = new Chart(ctxMonth).Line(emissionsPerMonth);


  var emissionsPerYear = {
    labels: ["2008", "2009", "2010", "2011","2012", "2013", "2014", "2015"],
    datasets: [
        {
            label: "Emissions per year in Texas",
            fillColor: "rgba(220,220,220,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(220,220,220,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: {{emissions_per_year}}
        }
    ]
  };
  var ctxYear = document.getElementById("emissionsPerYear").getContext("2d");
  var myBarChart = new Chart(ctxYear).Bar(emissionsPerYear);
</script>
{% endblock %}
